apply plugin: 'java-library'
apply plugin: "com.github.sherter.google-java-format"

// Checker Framework pluggable type-checking
apply from: 'gradle/checkerframework.gradle'

dependencies {
  api group: 'org.checkerframework.annotatedlib', name: 'bcel', version: '0.0.5'

  implementation 'org.apache.commons:commons-math3:3.6.1'
  implementation 'com.google.guava:guava:20.0'

  testImplementation 'junit:junit:4.12'
}

repositories {
  jcenter()
  mavenCentral()
}

sourceCompatibility = 1.7
targetCompatibility = 1.7


///////////////////////////////////////////////////////////////////////////
/// Code formatting
///

buildscript {
  repositories {
    maven {
      url "https://plugins.gradle.org/m2/"
    }
  }
  dependencies {
    classpath "gradle.plugin.com.github.sherter.google-java-format:google-java-format-gradle-plugin:0.6"
  }
}

googleJavaFormat {
  toolVersion '1.3'
  // exclude '**/CloneVisitor.java'
}

tasks.googleJavaFormat {
  group 'Formatting'
  description = "Reformat Java source code with Google-Java-format"
  exclude 'src/testinput'
}

tasks.verifyGoogleJavaFormat {
  group 'Formatting'
  description = "Check Java source code formatting with Google-Java-format"
  exclude 'src/testinput'
}

// Run googleJavaFormat before compiling (would be better to just verify?)
tasks.withType(JavaCompile) {
  dependsOn 'googleJavaFormat' // task name conflicts with plugin name
}
